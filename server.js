const express=require("express"),PATH=require("path"),bodyParser=require("body-parser"),fs=require("fs").promises,app=express(),port=3e3,DF=PATH.join(__dirname,"feedback-data.json");let fb=[];async function load(){try{const e=await fs.readFile(DF,"utf8");fb=JSON.parse(e)}catch(e){fb=[]}}async function save(){await fs.writeFile(DF,JSON.stringify(fb,null,2),"utf8")}function genId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let a="";for(let s=0;s<12;s++)a+=e.charAt(Math.floor(Math.random()*e.length));return a}app.use(express.static(__dirname)),app.use(bodyParser.json()),app.post("/api/feedback",(async(e,a)=>{const s={...e.body,id:genId(),status:"Open",createdAt:(new Date).toISOString()};fb.push(s),await save(),a.status(201).json({message:"Feedback submitted successfully!",data:s})})),app.get("/api/feedback",((e,a)=>{a.json(fb)})),app.put("/api/feedback/:id",(async(e,a)=>{const s=e.params.id,{status:t}=e.body,n=fb.find((e=>e.id===s));if(t)return n.status=t,await save(),a.json({message:"Changes saved",data:n})})),app.delete("/api/feedback/:id",(async(e,a)=>{const s=e.params.id,t=fb.length;if(fb=fb.filter((e=>e.id!==s)),fb.length<t)return await save(),a.json({message:"Entry deleted"})})),app.get(["/","/feedbackForm","/admin"],((e,a)=>{a.sendFile(PATH.join(__dirname,"index.html"))})),load().then((()=>{app.listen(3e3,(()=>{}))}));