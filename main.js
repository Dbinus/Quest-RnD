document.addEventListener("DOMContentLoaded",(async()=>{let e=[],t=[],n=1,d=10,a=null,c={};async function o(){try{const t=await fetch("/api/feedback");t.ok&&(e=await t.json())}catch(e){}}function s(e){const t="admin"===e?"/admin":"/feedbackForm";window.location.pathname!==t&&window.history.pushState({page:e},"",t)}async function i(){const e=window.location.pathname;e.includes("/admin")?await u():(e.includes("/feedbackForm"),l())}function m(){document.getElementById("ovl").classList.toggle("act")}function l(){s("feedback"),document.getElementById("fc").classList.remove("hid"),document.getElementById("ap").classList.remove("act"),document.getElementById("ovl").classList.remove("act"),document.getElementById("btnF").classList.add("am"),document.getElementById("btnA").classList.remove("am");const e=document.querySelector(".ab");e&&e.remove(),document.getElementById("btnF").innerHTML='<span>Feedback form</span><span class="ab">Active</span>'}async function u(){s("admin"),document.getElementById("fc").classList.add("hid"),document.getElementById("ap").classList.add("act"),document.getElementById("ovl").classList.remove("act"),document.getElementById("btnF").classList.remove("am"),document.getElementById("btnA").classList.add("am");const e=document.querySelector(".ab");e&&e.remove(),document.getElementById("btnA").innerHTML='<span>Admin panel</span><span class="ab">Active</span>',await r()}async function r(){await o(),t=[...e],g()}function g(){const e=document.getElementById("tb");if(e.innerHTML="",0===t.length)return e.innerHTML='<tr><td colspan="9" style="text-align: center;">No data available</td></tr>',void y();const a=(n-1)*d,c=a+d;t.slice(a,c).forEach(((t,n)=>{e.insertRow().innerHTML=`\n                <td>${t.id}</td>\n                <td>${t.name}</td>\n                <td>${t.eventName}</td>\n                <td>${t.email}</td>\n                <td>${t.division}</td>\n                <td>${t.rating}</td>\n                <td>${t.status||"Open"}</td>\n                <td>${t.comments?t.comments.length>30?t.comments.substring(0,30)+"...":t.comments:""}</td>\n                <td class="abt">\n                    <button class="be" onclick="view('${t.id}')">Edit</button>\n                    <button class="bd" onclick="del('${t.id}')">Delete</button>\n                </td>\n            `})),y()}function y(){const a=0===t.length?0:(n-1)*d+1,c=Math.min(a+d-1,t.length),o=t.length;document.getElementById("pi").textContent=`Showing ${a} to ${c} of ${o} entries${t.length!==e.length?` (filtered from ${e.length} total entries)`:""}`,document.getElementById("prev").disabled=1===n,document.getElementById("next").disabled=c>=o}function E(){document.getElementById("mdl").classList.remove("act"),document.getElementById("mdl").dataset.editingId=""}window.view=function(t){const n=e.find((e=>e.id===t));if(n){const e=new Date(n.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});document.getElementById("mDt").value=e,document.getElementById("mId").value=n.id,document.getElementById("mNm").value=n.name,document.getElementById("mEm").value=n.email,document.getElementById("mDiv").value=n.division,document.getElementById("mEv").value=n.eventName,document.getElementById("mRt").value=n.rating,document.getElementById("mSt").value=n.status||"Open",document.getElementById("mCom").value=n.comments||"",document.getElementById("mSug").value=n.suggestions||"",document.getElementById("mdl").dataset.editingId=n.id,document.getElementById("mdl").classList.add("act")}},window.del=async function(e){if(confirm("Are you sure you want to delete this entry?")){(await fetch(`/api/feedback/${e}`,{method:"DELETE"})).ok?(alert("Entry deleted successfully"),await r()):alert("Failed to delete entry")}},await o(),document.getElementById("hBF").addEventListener("click",m),document.getElementById("hBA").addEventListener("click",m);const v=document.querySelectorAll(".rb");v.forEach((e=>{e.addEventListener("click",(()=>{v.forEach((e=>e.classList.remove("sel"))),e.classList.add("sel"),a=e.dataset.rating}))})),document.getElementById("fbf").addEventListener("submit",(async function(e){if(e.preventDefault(),!a)return void alert("Select a rating");const t={name:document.getElementById("nm").value,email:document.getElementById("em").value,division:document.getElementById("div").value,eventName:document.getElementById("ev").value,rating:parseInt(a),comments:document.getElementById("com").value,suggestions:document.getElementById("sug").value},n=await fetch("/api/feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(n.ok){const e=await n.json();alert(e.message),this.reset(),v.forEach((e=>e.classList.remove("sel"))),a=null}else alert("Failed to submit feedback")})),document.getElementById("btnF").addEventListener("click",l),document.getElementById("btnA").addEventListener("click",u),document.getElementById("cls").addEventListener("click",E),document.getElementById("cnc").addEventListener("click",E),document.getElementById("mdl").addEventListener("click",(function(e){e.target===this&&E()})),document.getElementById("sav").addEventListener("click",(async function(){const e=document.getElementById("mdl").dataset.editingId,t=document.getElementById("mSt").value;(await fetch(`/api/feedback/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t})})).ok?(alert("Changes saved successfully"),E(),await r()):alert("Failed to save changes")})),document.getElementById("ovl").addEventListener("click",(function(e){e.target===this&&m()})),document.getElementById("prev").addEventListener("click",(function(){n>1&&(n--,g())})),document.getElementById("next").addEventListener("click",(function(){const e=Math.ceil(t.length/d);n<e&&(n++,g())})),document.getElementById("epp").addEventListener("change",(function(){d=parseInt(document.getElementById("epp").value),n=1,g()})),document.getElementById("si").addEventListener("keyup",(function(){const d=document.getElementById("si").value.toLowerCase();t=e.filter((e=>e.name.toLowerCase().includes(d)||e.id.toLowerCase().includes(d)||e.eventName.toLowerCase().includes(d)||e.email.toLowerCase().includes(d)||e.division.toLowerCase().includes(d)||e.comments&&e.comments.toLowerCase().includes(d)||e.rating.toString().includes(d))),n=1,g()})),document.querySelectorAll(".dt th[data-column]").forEach((e=>{e.addEventListener("click",(function(){!function(e){const n="asc"===c[e]?"desc":"asc";c[e]=n;const d=["id","name","eventName","email","division","rating","status","comments"][e];t.sort(((e,t)=>{let a=e[d],c=t[d];return"string"==typeof a&&(a=a.toLowerCase(),c=c?c.toLowerCase():""),"asc"===n?a>c?1:-1:a<c?1:-1})),g()}(parseInt(this.dataset.column))}))})),window.addEventListener("popstate",i),await i()}));